#!/usr/bin/env bash
# GitHub Workflows Documentation
# Shows the relationship between CI and Security workflows

set -euo pipefail

echo "ğŸ“‹ GitHub Workflows Overview"
echo "============================"
echo ""

echo "ğŸ”„ Workflow Dependencies:"
echo ""
echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    triggers    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
echo "â”‚   CI.yaml   â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚ security.yaml   â”‚"
echo "â”‚             â”‚                 â”‚                 â”‚"
echo "â”‚ â€¢ Lint      â”‚                 â”‚ â€¢ Bandit scan   â”‚"
echo "â”‚ â€¢ Format    â”‚                 â”‚ â€¢ pip-audit     â”‚"
echo "â”‚ â€¢ Type      â”‚                 â”‚ â€¢ Reports       â”‚"
echo "â”‚ â€¢ Tests     â”‚                 â”‚                 â”‚"
echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
echo ""

echo "ğŸ¯ Execution Flow:"
echo ""
echo "1ï¸âƒ£  Developer pushes code or creates PR"
echo "2ï¸âƒ£  CI workflow runs immediately:"
echo "    â€¢ Linting (ruff check)"
echo "    â€¢ Formatting (ruff format)"
echo "    â€¢ Type checking (ty)"
echo "    â€¢ Tests (pytest)"
echo ""
echo "3ï¸âƒ£  If CI succeeds, Security workflow runs:"
echo "    â€¢ Bandit security scan"
echo "    â€¢ pip-audit dependency scan"
echo "    â€¢ Generates security reports"
echo ""
echo "4ï¸âƒ£  If CI fails, Security workflow is skipped"
echo ""

echo "ğŸ’¡ Key Benefits:"
echo ""
echo "âœ… Parallel execution on PR/push events"
echo "âœ… Security only runs if code quality passes"
echo "âœ… Clear separation of concerns"
echo "âœ… Independent failure handling"
echo "âœ… Artifact collection for security reports"
echo "âœ… Local security checks via 'make security'"
echo ""

echo "ğŸ”§ Local Development:"
echo ""
echo "Run the same checks locally:"
echo "  make ci        # Run CI pipeline locally"
echo "  make security  # Run security checks locally"
echo "  make help      # See all available commands"
echo ""

echo "ğŸ“Š Workflow Files:"
echo "  .github/workflows/ci.yaml        - Code quality pipeline"
echo "  .github/workflows/security.yaml  - Security scanning"
echo "  .github/workflows/push-images.yaml - Deployment pipeline"
